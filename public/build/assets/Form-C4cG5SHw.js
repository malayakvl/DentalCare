import{u as p,c as J,r as g,W as M,F as S,j as e,a as b,G as W,H as $,v as f,I as K,J as F,y as C}from"./app-DUD9FxAe.js";import{P as O}from"./PrimaryButton-DDpmqCs-.js";import{a as Q,L as U}from"./lang-Rf8_tUbV.js";import{l as X}from"./translation-xJPwW3Hr.js";import{I as d}from"./InputText-8GBDd7K4.js";import{I as Y}from"./InputTreeSelect-Ciw_oVnd.js";import{u as Z}from"./selectors-BaSUzsHv.js";import{u as D,b as ee,c as te}from"./selectors-DcLeQ0hp.js";import{I as N}from"./InputSelect-BKKZVYkM.js";import{z as ae}from"./transition-Dk6MwGSW.js";import"./reselect-NCCDNIWx.js";import"./InputLabel-Doo0KOeK.js";import"./translation-hRiGdJJJ.js";function _e({clinicData:P,formData:i,categoryData:k,unitsData:x,className:w=""}){const R=p(Q),s=new U({messages:X,locale:R}),c=J(),[t,o]=g.useState({name:i.name,price:i.price,retail_price:i.retail_price,clinic_id:P.id,category_id:i.category_id,unit:i.unit,unit_id:i.unit_id,weightunit_id:i.weightunit_id,weight:i.weight,producer:i.producer,percent:i.percent,price_per_unit:i.price_per_unit}),[re,m]=g.useState(!1),v=p(Z);p(D);const _=p(ee),u=p(te),{processing:z,recentlySuccessful:q,errors:ie}=M();g.useEffect(()=>{u&&c(S(u))},[u]);const h=a=>{const r=a.target.id,n=a.target.value;c(W(a.target.value)),o(l=>({...l,[r]:n})),t.weight&&(t.price_per_unit=parseFloat(String(t.retail_price/t.weight)).toFixed(2))},A=a=>{const r=a.target.id,n=a.target.value;o(l=>({...l,[r]:n}))};g.useEffect(()=>{if(t.price&&u){const a=parseFloat(t.price),r=1+parseFloat(u)/100,n=(a*r).toFixed(2),l="retail_price";o(y=>({...y,[l]:n}))}},[t.price]);const I=a=>{const r=a.target.id,n=a.target.value;o(l=>({...l,[r]:n}))},j=a=>{const r=a.target.id,n=a.target.value;o(G=>({...G,[r]:n}));const l=parseFloat(t.price),B=((parseFloat(n)-l)/l).toFixed(2);c(S(B*100))},V=a=>{const r=a.target.id,n=a.target.value;n.length>3?c($(a.target.value)):(c(f()),m(!1)),o(l=>({...l,[r]:n}))},E=a=>{const r=a.target.id,n=a.target.value;n.length>=1?c(K(a.target.value)):(c(F()),m(!1)),t.price_per_unit=parseFloat(String(t.retail_price/t.weight)).toFixed(2),o(l=>({...l,[r]:n}))},L=a=>{a.preventDefault(),i.id?C.post(`/material/update?id=${i.id}`,t):C.post("/material/update",t)},T=()=>v.length>0?e.jsx("div",{className:"absolute autocomplete",children:e.jsx("ul",{children:v.map(a=>e.jsx("li",{className:"cursor-pointer py-1",onClick:()=>{m(!0),c(f()),o(r=>({...r,producer:a.name}))},children:a.name}))})}):e.jsx(e.Fragment,{}),H=()=>_.length>0?e.jsx("div",{className:"absolute autocomplete",children:e.jsx("ul",{children:_.map(a=>e.jsx("li",{className:"cursor-pointer py-1",onClick:()=>{m(!0),c(F()),o(r=>({...r,size:a.name}))},children:a.name}))})}):e.jsx(e.Fragment,{});return e.jsxs("section",{className:w,children:[e.jsx("header",{children:e.jsxs("h2",{children:[e.jsx(b,{className:"icon-back",href:"/materials",children:"Â "}),i!=null&&i.id?s.get("material.title.edit"):s.get("material.title.create")]})}),e.jsxs("form",{onSubmit:L,className:"mt-0 space-y-4",children:[e.jsx(Y,{name:"category_id",values:t,value:t.category_id,options:k,onChange:h,required:!0,label:s.get("material.category")}),e.jsx(d,{name:"name",values:t,dataValue:t.name,value:t.name,onChange:A,required:!0,label:s.get("material.name")}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{name:"producer",values:t,value:t.producer,onChange:V,required:!0,label:s.get("material.producer")}),e.jsx(e.Fragment,{children:T()})]}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{name:"price",values:t,dataValue:t.price,value:t.price,onChange:I,required:!0,label:s.get("material.price")}),e.jsx("span",{className:"percent-price",children:u&&s.get("material.percent")+": "+u+"%"})]}),e.jsx(d,{name:"retail_price",values:t,dataValue:t.retail_price,value:t.retail_price,onChange:j,required:!0,label:s.get("material.retail_price")}),e.jsx("div",{className:"relative",children:e.jsx(N,{translatable:!1,name:"unit_id",className:"mb-1",values:t,value:t.unit_id,options:x,onChange:h,required:!0,label:s.get("material.unit")})}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{name:"weight",values:t,value:t.weight,onChange:E,label:s.get("material.size")}),e.jsx(e.Fragment,{children:H()})]}),e.jsx("div",{className:"relative",children:e.jsx(N,{translatable:!1,name:"weightunit_id",className:"mb-1",values:t,value:t.weightunit_id,options:x,onChange:h,required:!0,label:s.get("material.sizeunit")})}),e.jsx(d,{name:"price_per_unit",values:t,dataValue:t.price_per_unit,value:t.price_per_unit,onChange:j,required:!0,label:s.get("material.price.per.unit")}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{className:"btn-back",title:s.get("material.back"),href:"/materials",children:s.get("material.back")}),e.jsx(O,{disabled:z,children:s.get("material.save")}),e.jsx(ae,{show:q,enter:"transition ease-in-out",enterFrom:"opacity-0",leave:"transition ease-in-out",leaveTo:"opacity-0",children:e.jsx("p",{className:"text-sm text-gray-600",children:s.get("producer.saved")})})]})]})]})}export{_e as default};
